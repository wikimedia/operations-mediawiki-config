{
  "comments": [
    {
      "key": {
        "uuid": "15601a97_2c3164e2",
        "filename": "wmf-config/CommonSettings.php",
        "patchSetId": 2
      },
      "lineNbr": 84,
      "author": {
        "id": 221
      },
      "writtenOn": "2019-02-05T15:01:31Z",
      "side": 1,
      "message": "cf. https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/core/+/1762dcfd2f1bc8c33e059dba076c1af1503f9378/includes/Setup.php#68",
      "revId": "27b51695f060336e8168aa75f959e9f4fc51b572",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fc7777df_20ed7936",
        "filename": "wmf-config/CommonSettings.php",
        "patchSetId": 2
      },
      "lineNbr": 84,
      "author": {
        "id": 34
      },
      "writtenOn": "2019-02-05T21:17:34Z",
      "side": 1,
      "message": "Re-creating the include path imho violates the separation of concerns and seems costly in terms of maintenance long-term.\n\nCan we instead do a pure \"add\" for the two bits we want to add? (usr lib, and usr share). Presumably that\u0027s composer does as well.",
      "parentUuid": "15601a97_2c3164e2",
      "revId": "27b51695f060336e8168aa75f959e9f4fc51b572",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ca52ffc3_129c3bbc",
        "filename": "wmf-config/CommonSettings.php",
        "patchSetId": 2
      },
      "lineNbr": 84,
      "author": {
        "id": 221
      },
      "writtenOn": "2019-02-05T21:38:19Z",
      "side": 1,
      "message": "Does the set_include_path() exist here in the first place only because we wanted to include $IP and /usr/local/lib/php, or also because we wanted to remove . and /srv/mediawiki/php? This goes back to the initial checkin of operations/mediawiki-config, so git history doesn\u0027t help.\n\nYou can see in T215224#4927484 what the include path is being set to by composer, which does just prepend its paths to the existing path.\n\nAt any rate, I\u0027d be wary of going back to including . in particular when we haven\u0027t had it in the path for many years. My goal here was just to add in composer\u0027s paths without changing anything else. If you want to follow up to change the non-composer bits or submit your own patch to do something different, feel free.",
      "parentUuid": "fc7777df_20ed7936",
      "revId": "27b51695f060336e8168aa75f959e9f4fc51b572",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "32aa7f4f_639374e1",
        "filename": "wmf-config/CommonSettings.php",
        "patchSetId": 2
      },
      "lineNbr": 84,
      "author": {
        "id": 34
      },
      "writtenOn": "2019-02-05T21:41:56Z",
      "side": 1,
      "message": "Good point. This isn\u0027t just about trying to make it match what it would otherwise be, it\u0027s also about keeping out the other bits we don\u0027t want.\n\nI suppose we\u0027ll want to experiment after this with removing $IP and the other two include paths, assuming we don\u0027t use them currently.\n\nThen after that, we could try and find a way to make them not be in the include path in the first place, e.g. through php.ini or some such, then we could remove this in favour of MW core and Composer adding their bits and nothing else being in there.",
      "parentUuid": "ca52ffc3_129c3bbc",
      "revId": "27b51695f060336e8168aa75f959e9f4fc51b572",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7e06b272_18062ad6",
        "filename": "wmf-config/CommonSettings.php",
        "patchSetId": 2
      },
      "lineNbr": 84,
      "author": {
        "id": 221
      },
      "writtenOn": "2019-02-05T22:00:03Z",
      "side": 1,
      "message": "MW core doesn\u0027t set any include paths of its own, it\u0027s just Composer that does.",
      "parentUuid": "32aa7f4f_639374e1",
      "revId": "27b51695f060336e8168aa75f959e9f4fc51b572",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "267f0fc5_4f18b3a6",
        "filename": "wmf-config/CommonSettings.php",
        "patchSetId": 2
      },
      "lineNbr": 84,
      "author": {
        "id": 34
      },
      "writtenOn": "2019-02-05T22:16:46Z",
      "side": 1,
      "message": "Yeah, I mentioned core as matter of principal. that is, core, wmf-config composer, and core composer are all in this run-time together and should in generally be able to add things to it and expect it to work.",
      "parentUuid": "7e06b272_18062ad6",
      "revId": "27b51695f060336e8168aa75f959e9f4fc51b572",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3a443489_13584259",
        "filename": "wmf-config/CommonSettings.php",
        "patchSetId": 2
      },
      "lineNbr": 84,
      "author": {
        "id": 389
      },
      "writtenOn": "2019-02-05T22:34:48Z",
      "side": 1,
      "message": "\u003e Then after that, we could try and find a way to make them not be in the include path in the first place, e.g. through php.ini or some such, then we could remove this in favour of MW core and Composer adding their bits and nothing else being in there.\n\nOTOH it is pretty easy to catch unwanted includes at this point, while preventing them in INI files seems inherently fragile. Not sure how much we care about robustness (security maybe, if some of the included-by-default directories have different write permissions? seems unlikely though), but four extra lines of code seems like a small price to pay.\n\nAnyway this patch fixes a nasty bug in production which probably causes some Echo notifications to fail, so let\u0027s get it out before all else.",
      "parentUuid": "267f0fc5_4f18b3a6",
      "revId": "27b51695f060336e8168aa75f959e9f4fc51b572",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "aa6b5ef6_73a9a0c0",
        "filename": "wmf-config/CommonSettings.php",
        "patchSetId": 2
      },
      "lineNbr": 84,
      "author": {
        "id": 221
      },
      "writtenOn": "2019-02-06T15:32:34Z",
      "side": 1,
      "message": "\u0027.\u0027 is often the security problem with respect to unexpected write permissions, as it\u0027s hard to know that the cwd is always going to be what you expect.\n\nBut, I just learned, even if \".\" isn\u0027t in the include_path PHP still acts like the include_path implicitly had __DIR__ and \u0027.\u0027 at the end anyway. Sigh. Still better for it to be at the very end rather than before the system directories though.",
      "parentUuid": "3a443489_13584259",
      "revId": "27b51695f060336e8168aa75f959e9f4fc51b572",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": true
    }
  ]
}