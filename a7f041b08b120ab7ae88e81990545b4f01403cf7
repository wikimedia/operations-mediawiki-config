{
  "comments": [
    {
      "key": {
        "uuid": "bc007fb3_9b04a32d",
        "filename": "wmf-config/etcd.php",
        "patchSetId": 2
      },
      "lineNbr": 29,
      "author": {
        "id": 16
      },
      "writtenOn": "2018-10-03T19:24:15Z",
      "side": 1,
      "message": "Seems like it might be too early to do this. I\u0027d recommend using function_exists() with a simplified version of that code.",
      "revId": "a7f041b08b120ab7ae88e81990545b4f01403cf7",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c42391a1_38fc3e56",
        "filename": "wmf-config/etcd.php",
        "patchSetId": 2
      },
      "lineNbr": 29,
      "author": {
        "id": 34
      },
      "writtenOn": "2018-10-03T19:48:09Z",
      "side": 1,
      "message": "+1 for something simpler like\n\n elseif ( function_exists( \u0027apcu_fetch\u0027 ) {\n  // PHP 7 with php-apcu\n  $localCache \u003d new APCUBagOStuff;\n } else {\n  // HHVM\n  $localCache \u003d new APCBagOStuff;",
      "parentUuid": "bc007fb3_9b04a32d",
      "revId": "a7f041b08b120ab7ae88e81990545b4f01403cf7",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "54dc1162_e1a8d7d5",
        "filename": "wmf-config/etcd.php",
        "patchSetId": 2
      },
      "lineNbr": 29,
      "author": {
        "id": 1616
      },
      "writtenOn": "2018-10-04T06:40:57Z",
      "side": 1,
      "message": "I can assure it\u0027s not too early, I checked repeatedly and the  Object caches are setup in DefaultSettings.php which is loaded before this file. Also, I tested it in beta while trying to make php-fpm work :P\n\nA good middle ground would be to use the detectLocalServerCache, which is a static function that doesn\u0027t depend on anything else to be defined.\n\nWould that be ok? Else I\u0027ll just go with reproducing that function as you suggested.",
      "parentUuid": "c42391a1_38fc3e56",
      "revId": "a7f041b08b120ab7ae88e81990545b4f01403cf7",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "89cc9406_0163f84a",
        "filename": "wmf-config/etcd.php",
        "patchSetId": 2
      },
      "lineNbr": 29,
      "author": {
        "id": 16
      },
      "writtenOn": "2018-10-04T16:24:26Z",
      "side": 1,
      "message": "I worry about the comment that says that no globals (aside from two) can be used and it being before InitialiseSettings.php. Calling newFromId() seems too risky/fragile, especially for something cross-repo where there is poor visibility into the dependency.",
      "parentUuid": "54dc1162_e1a8d7d5",
      "revId": "a7f041b08b120ab7ae88e81990545b4f01403cf7",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1d4eef0d_0742e316",
        "filename": "wmf-config/etcd.php",
        "patchSetId": 2
      },
      "lineNbr": 29,
      "author": {
        "id": 34
      },
      "writtenOn": "2018-10-04T19:25:10Z",
      "side": 1,
      "message": "I was actually hoping to keep this file as plain PHP (no MW classes), but I guess since we need EtcdConfig that\u0027s not really an option right now.\n\nI agree that detectLocalServerCache() would be fine to call. However it\u0027s return value isn\u0027t useful. It\u0027s only useful to pass to newFromId, which we don\u0027t want to do here.\n\nChecking its return value directly against strings would be unsupported given these are internal IDs.\n\nBut if we pretend for a moment that we\u0027ll definitely never change those and definitely remember about this file in wmf-config when we do change it, we\u0027d have it as follows:\n\n $cacheId \u003d \\ObjectCache::detectLocalServerCache();\n if ( $cacheId \u003d\u003d\u003d \u0027apcu\u0027 ) {\n   $localCache \u003d new APCUBagOStuff;\n } elseif {\n   $localCache \u003d new APCBagOStuff;\n }\n\nWhich doesn\u0027t seem beneficial for the added cost of indirection, compared to:\n\n if ( function_exists( \u0027apcu_fetch\u0027 ) ) {\n   $localCache \u003d new APCUBagOStuff;\n } elseif {\n   $localCache \u003d new APCBagOStuff;\n }",
      "parentUuid": "89cc9406_0163f84a",
      "revId": "a7f041b08b120ab7ae88e81990545b4f01403cf7",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fb4e1674_2a6dbf20",
        "filename": "wmf-config/etcd.php",
        "patchSetId": 2
      },
      "lineNbr": 29,
      "author": {
        "id": 1616
      },
      "writtenOn": "2018-10-05T05:56:10Z",
      "side": 1,
      "message": "Fair enough",
      "parentUuid": "1d4eef0d_0742e316",
      "revId": "a7f041b08b120ab7ae88e81990545b4f01403cf7",
      "serverId": "e9e9afe9-4712-486d-8885-f54b72dd1951",
      "unresolved": false
    }
  ]
}